<!DOCTYPE html> 
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<head th:replace="layout::head"></head>
<body>
<script th:src="@{/js/registro-cuenta-bancaria-deposito.js}"></script>
	<div class="d-flex" id="content-wrapper">
		<!-- Sidebar -->
		<div th:replace="layout::sidebar"></div>
		<!-- Fin sidebar -->

		<div class="w-100">

			<!-- Navbar -->
			<nav th:replace="layout::navbar"></nav>
			<!-- Fin Navbar -->

			<!-- Page Content -->
			<div id="content" class="bg-grey w-100">
				<section class="bg-light py-3">
					<div class="row">
						<div class="col-lg-7">
							<div class="p-5">
								<div class="text-center">
									<h1 class="h4 text-gray-900 mb-4">Añadir una 
										Oportunidad</h1>
								</div>
								<div th:if=${param.exito}>
									<div class="alert alert-info" id="alerta">Se ha
										ñadido exitosamente la Factura</div>
								</div>
								<div class="form-inline">
							    <div class="form-group mb-2">
							        <label for="validationCustom07" class="form-label">Empresa:</label>
							    </div>
							    <div class="form-group mx-sm-3 mb-2">
							        <select class="custom-select" name="empresaSelect" id="empresaSelect" required>
							            <option selected value="">Seleccione...</option>
							            <option th:each="e: ${lstEmpresa}" th:value="${e.ruc}" th:text="${e.razonsocial}"></option>
							        </select>
							    </div>
							    <div class="form-group mx-sm-5 mb-2">
							        <button type="button" class="btn btn-primary btn-block" id="buscarFactura-btn">Buscar</button>
							    </div>
							</div>
							<div class="container">
							    <table id="tblfactura" class="table">
							        <thead>
							        <tr>
							            <th scope="col">Código</th>
							            <th scope="col">Fecha de Registro</th>
							            <th scope="col">Fecha de Vencimiento</th>
							            <th scope="col">Monto</th>
							            <th scope="col"></th>
							        </tr>
							        </thead>
							        <tbody></tbody>
							    </table>
							</div>		    
							</div>
						</div>
						<div class="col-lg-5 d-none d-lg-block bg-register-image">
							<img class="img-fluid" th:src="@{/img/factura_img.jpg}">
						</div>
					</div>
				</section>
			</div>
		</div>
	</div>
</body>
<script type="text/javascript">
	$(document).ready(function() {
	    $("#buscarFactura-btn").click(function() {
	        var empresaRuc = $("#empresaSelect").val();
	
	        $.ajax({
	            url: "/oportunidad/facturas",
	            type: "GET",
	            data: { ruc: empresaRuc },
	            success: function(data) {
	                $("#tblfactura tbody").empty();
	
	                // Agregar los datos de las facturas a la tabla
	                data.forEach(function(factura) {
	                    var row = "<tr>";
	                    row += "<td>" + factura[0] + "</td>";
	                    row += "<td>" + factura[1] + "</td>";
	                    row += "<td>" + factura[2] + "</td>";
	                    row += "<td>" + "S/" + factura[3] + "</td>";
	                    row += "<td></td>";
	                    row += "</tr>";
	                    $("#tblfactura tbody").append(row);
	                });
	            },
	            error: function(xhr, status, error) {
	                console.log(error);
	            }
	        });
	    });
	});
</script>

</html>